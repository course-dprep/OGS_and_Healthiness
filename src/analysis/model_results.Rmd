---
title: "Model results & summaries"
output: pdf_document
output_dir: "../../src/paper/"
---

```{r load_packages, include=FALSE, message=FALSE, warning=FALSE}
library(data.table)
library(tidyr)
library(ggplot2)
library(kableExtra)
library(did)
library(tinytex)
```


```{r extract_data, include=FALSE, message=FALSE, warning=FALSE}
results_list <- readRDS("../../gen/analysis/did_effects_list.rds")

average_did_effect <- results_list$average_did_effect
time_window_effects <- results_list$time_window_effects
cohort_effects <- results_list$cohort_effects
```




This study analyzes the impact of household adoption of online grocery shopping channels on the healthiness of their total grocery purchases, both online and offline. To assess this, I applied the difference-in-differences (DiD) model proposed by Sant'Anna & Callaway (2021) to grocery purchase data from 150 households over a one-year period. This method accounts for staggered adoption, meaning that households begin shopping online at different points in time. This report presents the main findings of the model. 


## Total effect

Healthiness is measured as the proportion of a household's monetary budget spent on fruits and vegetables. Table 1 below presents the overall effect of the DiD model. While the Average Treatment Effect (ATT) indicates a potential decline in the proportion of spending on fruits and vegetables, the 95% confidence interval (CI), ranging from -5.729 to 0.850, suggests that this effect is not statistically significant.



```{r average_effect, echo=FALSE, results='asis'}
average_effect_df <- data.frame(
  ATT = average_did_effect$overall.att,
  Std_Error = average_did_effect$overall.se,
  CI_Lower = average_did_effect$overall.att - 1.96 * average_did_effect$overall.se,
  CI_Upper = average_did_effect$overall.att + 1.96 * average_did_effect$overall.se)

kable(average_effect_df, caption = "Average Treatment Effect (ATT)") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

## Relative time window effects

A second method to analyze the results is to look at it in the form of a event study plot. Figure 1 below illustrates the average treatment effect (ATT) of households adopting online grocery shopping over a relative time window of 8 weeks around the adoption event. Each point on the plot represents the estimated ATT for a specific week relative to the adoption, with corresponding  95% CIs. The vast majority of these intervals cross zero, indicating a non-significant effect. This graph shows that there is no clear trend change in proportion of expenditure towards fruits and vegetables after adoption (t=0).

```{r time_window, echo=FALSE, results='asis', fig.width=6, fig.height=4}
time_window_plot <- ggdid(time_window_effects)

# Modify the title
time_window_plot <- time_window_plot + 
  ggtitle("Figure 1. Event study plot of Average Treatment Effect (ATT) over time")
# Render the plot
print(time_window_plot)
```

## Cohort analysis

A final way to analyze the results is to look at different cohorts separately. The results presented before take households on average do not significantly change their expenditure towards fruits and vegetables after starting to shop online. In graph 2 below we identify the treatment effects and corresponding CIs for each cohort individually. 

The analysis of treatment effects by cohort shows significant variability in how households adjust their spending on fruits and vegetables after adopting online grocery shopping. While the overall average effect indicated no significant change, some cohorts exhibited notable decreases in expenditure, while others showed significant increases. These findings highlight the mixed outcomes of online grocery shopping on household food spending and suggests that different segments of the population respond differently to this shopping method. These findings underscore the importance of examining individual cohorts to understand the complex impacts of online grocery shopping on consumer behavior. In further research, I think it would be beneficial to identify different types of households, i.e. households with low versus high income or with versus without children, to see how the adoption of online groceries can affect different households in different ways.

```{r cohort_analysis, echo=FALSE, results='asis', fig.width=6, fig.height=4}
cohort_plot <- ggdid(cohort_effects)

# Modify the title
cohort_plot <- cohort_plot + 
  ggtitle("Figure 2. Average Treatment Effect (ATT) per cohort (adoption-week")

# Render the plot
print(cohort_plot)
```

## Conclusion

In this study, I used a staggered DiD approach to explore the impact of adopting online grocery shopping on the healthiness of household food purchases. The results from the DiD model point towards a decline in healthiness, i.e. a decline in the proportion of expenditure towards the healthy food categories fruits and vegetables. However, the Average Treatment Effect (ATT) was not statistically significant, as reflected in the 95% confidence interval ranging from -5.729 to 0.850.

Further analysis using an event study plot showed that the average treatment effect over an 8-week period surrounding the adoption event largely crossed zero, suggesting no clear trend in spending behavior post-adoption. Cohort analysis revealed significant variability in responses, with some households decreasing their spending on fruits and vegetables while others increased it. These mixed outcomes point to the complexity of consumer behavior in the context of online grocery shopping, emphasizing the need for more research into different household types. Deeper insights household differences could inform targeted interventions to promote healthier purchasing behaviors across consumer segments.


